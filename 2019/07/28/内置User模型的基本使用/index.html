<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    <title>内置User模型的基本使用 | Hexo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
      <link rel="icon" href="/favicon.png">
    

    <link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" href="/js/google-code-prettify/tomorrow-night-eighties.min.css">

  </head>

  <body>
</body></html>
<header>
	<a id="logo" href="/" title="Hexo">
	<img src="/favicon.png" alt="Hexo"></a>
	
	
		<!--搜索栏-->
		<i class="js-toggle-search iconfont icon-search"></i>


<form class="js-search search-form search-form--modal" method="get" action="http://gushi.li" role="search">
	<div class="search-form__inner">
		<div>
			<i class="iconfont icon-search"></i>
			<input class="text-input" placeholder="Enter Key..." type="search">
		</div>
	</div>
</form>
	

	
		<!--侧边导航栏-->
		<a id="nav-toggle" href="#"><span></span></a>

<nav>
	<div class="menu-top-container">
		<ul id="menu-top" class="menu">
			
				
				<li class="current-menu-item">
					<a href="http://weibo.com/" target="_blank">Weibo</a>
				</li>
			
		</ul>
	</div>
</nav>
	

</header>
<div class="m-header ">
	<section id="hero1" class="hero">
		<div class="inner">
		</div>
	</section>
	
		<figure class="top-image" data-enable=true></figure>
	
</div>

<!--文章列表-->
<div class="wrapper">
  
    <!--文章-->
<article>
	
  
    <h1 class="post-title" itemprop="name">
      内置User模型的基本使用
    </h1>
  

	<div class='post-body mb'>
		<h1 id="用户对象"><a href="#用户对象" class="headerlink" title="用户对象"></a>用户对象</h1><h2 id="User模型"><a href="#User模型" class="headerlink" title="User模型"></a>User模型</h2><p>User模型是这个框架的核心部分。他的完整的路径是在django.contrib.auth.models.User。以下对这个User对象做一个简单了解：</p>
<h3 id="字段："><a href="#字段：" class="headerlink" title="字段："></a>字段：</h3><p>内置的User模型拥有以下的字段：</p>
<ul>
<li><p>username：用户名。150个字符以内。可以包含数字和英文字符，以及_、@、+、.和-字符。不能为空，且必须唯一！</p>
</li>
<li><p>first_name：歪果仁的first_name，在30个字符以内。可以为空。</p>
</li>
<li><p>last_name：歪果仁的last_name，在150个字符以内。可以为空。</p>
</li>
<li><p>email：邮箱。可以为空。</p>
</li>
<li><p>password：密码。经过哈希过后的密码。</p>
</li>
<li><p>groups：分组。一个用户可以属于多个分组，一个分组可以拥有多个用户。groups这个字段是跟Group的一个多对多的关系。</p>
</li>
<li><p>user_permissions：权限。一个用户可以拥有多个权限，一个权限可以被多个用户所有用。和Permission属于一种多对多的关系。</p>
</li>
<li><p>is_staff：是否可以进入到admin的站点。代表是否是员工。</p>
</li>
<li><p>is_active：是否是可用的。对于一些想要删除账号的数据，我们设置这个值为False就可以了，而不是真正的从数据库中删除。</p>
</li>
<li><p>is_superuser：是否是超级管理员。如果是超级管理员，那么拥有整个网站的所有权限。</p>
</li>
<li><p>last_login：上次登录的时间。</p>
</li>
<li><p>date_joined：账号创建的时间。</p>
</li>
</ul>
<h3 id="Models类"><a href="#Models类" class="headerlink" title="Models类"></a>Models类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> auth</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.base_user <span class="keyword">import</span> AbstractBaseUser, BaseUserManager</span><br><span class="line"><span class="keyword">from</span> django.contrib.contenttypes.models <span class="keyword">import</span> ContentType</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> PermissionDenied</span><br><span class="line"><span class="keyword">from</span> django.core.mail <span class="keyword">import</span> send_mail</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.db.models.manager <span class="keyword">import</span> EmptyManager</span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"><span class="keyword">from</span> django.utils.translation <span class="keyword">import</span> gettext_lazy <span class="keyword">as</span> _</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .validators <span class="keyword">import</span> UnicodeUsernameValidator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_last_login</span><span class="params">(sender, user, **kwargs)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A signal receiver which updates the last_login date for</span></span><br><span class="line"><span class="string">    the user logging in.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    user.last_login = timezone.now()</span><br><span class="line">    user.save(update_fields=[<span class="string">'last_login'</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PermissionManager</span><span class="params">(models.Manager)</span>:</span></span><br><span class="line">    use_in_migrations = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_by_natural_key</span><span class="params">(self, codename, app_label, model)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.get(</span><br><span class="line">            codename=codename,</span><br><span class="line">            content_type=ContentType.objects.db_manager(self.db).get_by_natural_key(app_label, model),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Permission</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    The permissions system provides a way to assign permissions to specific</span></span><br><span class="line"><span class="string">    users and groups of users.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The permission system is used by the Django admin site, but may also be</span></span><br><span class="line"><span class="string">    useful in your own code. The Django admin site uses permissions as follows:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        - The "add" permission limits the user's ability to view the "add" form</span></span><br><span class="line"><span class="string">          and add an object.</span></span><br><span class="line"><span class="string">        - The "change" permission limits a user's ability to view the change</span></span><br><span class="line"><span class="string">          list, view the "change" form and change an object.</span></span><br><span class="line"><span class="string">        - The "delete" permission limits the ability to delete an object.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Permissions are set globally per type of object, not per specific object</span></span><br><span class="line"><span class="string">    instance. It is possible to say "Mary may change news stories," but it's</span></span><br><span class="line"><span class="string">    not currently possible to say "Mary may change news stories, but only the</span></span><br><span class="line"><span class="string">    ones she created herself" or "Mary may only change news stories that have a</span></span><br><span class="line"><span class="string">    certain status or publication date."</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Three basic permissions -- add, change and delete -- are automatically</span></span><br><span class="line"><span class="string">    created for each Django model.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    name = models.CharField(_(<span class="string">'name'</span>), max_length=<span class="number">255</span>)</span><br><span class="line">    content_type = models.ForeignKey(</span><br><span class="line">        ContentType,</span><br><span class="line">        models.CASCADE,</span><br><span class="line">        verbose_name=_(<span class="string">'content type'</span>),</span><br><span class="line">    )</span><br><span class="line">    codename = models.CharField(_(<span class="string">'codename'</span>), max_length=<span class="number">100</span>)</span><br><span class="line">    objects = PermissionManager()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = _(<span class="string">'permission'</span>)</span><br><span class="line">        verbose_name_plural = _(<span class="string">'permissions'</span>)</span><br><span class="line">        unique_together = ((<span class="string">'content_type'</span>, <span class="string">'codename'</span>),)</span><br><span class="line">        ordering = (<span class="string">'content_type__app_label'</span>, <span class="string">'content_type__model'</span>,</span><br><span class="line">                    <span class="string">'codename'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"%s | %s | %s"</span> % (</span><br><span class="line">            self.content_type.app_label,</span><br><span class="line">            self.content_type,</span><br><span class="line">            self.name,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">natural_key</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.codename,) + self.content_type.natural_key()</span><br><span class="line">    natural_key.dependencies = [<span class="string">'contenttypes.contenttype'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GroupManager</span><span class="params">(models.Manager)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    The manager for the auth's Group model.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    use_in_migrations = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_by_natural_key</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.get(name=name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Groups are a generic way of categorizing users to apply permissions, or</span></span><br><span class="line"><span class="string">    some other label, to those users. A user can belong to any number of</span></span><br><span class="line"><span class="string">    groups.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    A user in a group automatically has all the permissions granted to that</span></span><br><span class="line"><span class="string">    group. For example, if the group 'Site editors' has the permission</span></span><br><span class="line"><span class="string">    can_edit_home_page, any user in that group will have that permission.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Beyond permissions, groups are a convenient way to categorize users to</span></span><br><span class="line"><span class="string">    apply some label, or extended functionality, to them. For example, you</span></span><br><span class="line"><span class="string">    could create a group 'Special users', and you could write code that would</span></span><br><span class="line"><span class="string">    do special things to those users -- such as giving them access to a</span></span><br><span class="line"><span class="string">    members-only portion of your site, or sending them members-only email</span></span><br><span class="line"><span class="string">    messages.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    name = models.CharField(_(<span class="string">'name'</span>), max_length=<span class="number">80</span>, unique=<span class="literal">True</span>)</span><br><span class="line">    permissions = models.ManyToManyField(</span><br><span class="line">        Permission,</span><br><span class="line">        verbose_name=_(<span class="string">'permissions'</span>),</span><br><span class="line">        blank=<span class="literal">True</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    objects = GroupManager()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = _(<span class="string">'group'</span>)</span><br><span class="line">        verbose_name_plural = _(<span class="string">'groups'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">natural_key</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.name,)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserManager</span><span class="params">(BaseUserManager)</span>:</span></span><br><span class="line">    use_in_migrations = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_create_user</span><span class="params">(self, username, email, password, **extra_fields)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Create and save a user with the given username, email, and password.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'The given username must be set'</span>)</span><br><span class="line">        email = self.normalize_email(email)</span><br><span class="line">        username = self.model.normalize_username(username)</span><br><span class="line">        user = self.model(username=username, email=email, **extra_fields)</span><br><span class="line">        user.set_password(password)</span><br><span class="line">        user.save(using=self._db)</span><br><span class="line">        <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_user</span><span class="params">(self, username, email=None, password=None, **extra_fields)</span>:</span></span><br><span class="line">        extra_fields.setdefault(<span class="string">'is_staff'</span>, <span class="literal">False</span>)</span><br><span class="line">        extra_fields.setdefault(<span class="string">'is_superuser'</span>, <span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self._create_user(username, email, password, **extra_fields)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_superuser</span><span class="params">(self, username, email, password, **extra_fields)</span>:</span></span><br><span class="line">        extra_fields.setdefault(<span class="string">'is_staff'</span>, <span class="literal">True</span>)</span><br><span class="line">        extra_fields.setdefault(<span class="string">'is_superuser'</span>, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> extra_fields.get(<span class="string">'is_staff'</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'Superuser must have is_staff=True.'</span>)</span><br><span class="line">        <span class="keyword">if</span> extra_fields.get(<span class="string">'is_superuser'</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'Superuser must have is_superuser=True.'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._create_user(username, email, password, **extra_fields)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># A few helper functions for common logic between User and AnonymousUser.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_user_get_all_permissions</span><span class="params">(user, obj)</span>:</span></span><br><span class="line">    permissions = set()</span><br><span class="line">    <span class="keyword">for</span> backend <span class="keyword">in</span> auth.get_backends():</span><br><span class="line">        <span class="keyword">if</span> hasattr(backend, <span class="string">"get_all_permissions"</span>):</span><br><span class="line">            permissions.update(backend.get_all_permissions(user, obj))</span><br><span class="line">    <span class="keyword">return</span> permissions</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_user_has_perm</span><span class="params">(user, perm, obj)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A backend can raise `PermissionDenied` to short-circuit permission checking.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> backend <span class="keyword">in</span> auth.get_backends():</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(backend, <span class="string">'has_perm'</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> backend.has_perm(user, perm, obj):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> PermissionDenied:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_user_has_module_perms</span><span class="params">(user, app_label)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A backend can raise `PermissionDenied` to short-circuit permission checking.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> backend <span class="keyword">in</span> auth.get_backends():</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(backend, <span class="string">'has_module_perms'</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> backend.has_module_perms(user, app_label):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> PermissionDenied:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PermissionsMixin</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Add the fields and methods necessary to support the Group and Permission</span></span><br><span class="line"><span class="string">    models using the ModelBackend.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    is_superuser = models.BooleanField(</span><br><span class="line">        _(<span class="string">'superuser status'</span>),</span><br><span class="line">        default=<span class="literal">False</span>,</span><br><span class="line">        help_text=_(</span><br><span class="line">            <span class="string">'Designates that this user has all permissions without '</span></span><br><span class="line">            <span class="string">'explicitly assigning them.'</span></span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line">    groups = models.ManyToManyField(</span><br><span class="line">        Group,</span><br><span class="line">        verbose_name=_(<span class="string">'groups'</span>),</span><br><span class="line">        blank=<span class="literal">True</span>,</span><br><span class="line">        help_text=_(</span><br><span class="line">            <span class="string">'The groups this user belongs to. A user will get all permissions '</span></span><br><span class="line">            <span class="string">'granted to each of their groups.'</span></span><br><span class="line">        ),</span><br><span class="line">        related_name=<span class="string">"user_set"</span>,</span><br><span class="line">        related_query_name=<span class="string">"user"</span>,</span><br><span class="line">    )</span><br><span class="line">    user_permissions = models.ManyToManyField(</span><br><span class="line">        Permission,</span><br><span class="line">        verbose_name=_(<span class="string">'user permissions'</span>),</span><br><span class="line">        blank=<span class="literal">True</span>,</span><br><span class="line">        help_text=_(<span class="string">'Specific permissions for this user.'</span>),</span><br><span class="line">        related_name=<span class="string">"user_set"</span>,</span><br><span class="line">        related_query_name=<span class="string">"user"</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        abstract = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_group_permissions</span><span class="params">(self, obj=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Return a list of permission strings that this user has through their</span></span><br><span class="line"><span class="string">        groups. Query all available auth backends. If an object is passed in,</span></span><br><span class="line"><span class="string">        return only permissions matching this object.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        permissions = set()</span><br><span class="line">        <span class="keyword">for</span> backend <span class="keyword">in</span> auth.get_backends():</span><br><span class="line">            <span class="keyword">if</span> hasattr(backend, <span class="string">"get_group_permissions"</span>):</span><br><span class="line">                permissions.update(backend.get_group_permissions(self, obj))</span><br><span class="line">        <span class="keyword">return</span> permissions</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_all_permissions</span><span class="params">(self, obj=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> _user_get_all_permissions(self, obj)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_perm</span><span class="params">(self, perm, obj=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Return True if the user has the specified permission. Query all</span></span><br><span class="line"><span class="string">        available auth backends, but return immediately if any backend returns</span></span><br><span class="line"><span class="string">        True. Thus, a user who has permission from a single auth backend is</span></span><br><span class="line"><span class="string">        assumed to have permission in general. If an object is provided, check</span></span><br><span class="line"><span class="string">        permissions for that object.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># Active superusers have all permissions.</span></span><br><span class="line">        <span class="keyword">if</span> self.is_active <span class="keyword">and</span> self.is_superuser:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Otherwise we need to check the backends.</span></span><br><span class="line">        <span class="keyword">return</span> _user_has_perm(self, perm, obj)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_perms</span><span class="params">(self, perm_list, obj=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Return True if the user has each of the specified permissions. If</span></span><br><span class="line"><span class="string">        object is passed, check if the user has all required perms for it.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> all(self.has_perm(perm, obj) <span class="keyword">for</span> perm <span class="keyword">in</span> perm_list)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_module_perms</span><span class="params">(self, app_label)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Return True if the user has any permissions in the given app label.</span></span><br><span class="line"><span class="string">        Use simlar logic as has_perm(), above.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># Active superusers have all permissions.</span></span><br><span class="line">        <span class="keyword">if</span> self.is_active <span class="keyword">and</span> self.is_superuser:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _user_has_module_perms(self, app_label)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractUser</span><span class="params">(AbstractBaseUser, PermissionsMixin)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    An abstract base class implementing a fully featured User model with</span></span><br><span class="line"><span class="string">    admin-compliant permissions.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Username and password are required. Other fields are optional.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#用户名</span></span><br><span class="line">    username_validator = UnicodeUsernameValidator()</span><br><span class="line">		<span class="comment">#设置为唯一，并且以后验证用户名和密码是否正确的时候就是用的username</span></span><br><span class="line">    username = models.CharField(</span><br><span class="line">        _(<span class="string">'username'</span>),</span><br><span class="line">        max_length=<span class="number">150</span>,</span><br><span class="line">        unique=<span class="literal">True</span>,</span><br><span class="line">        help_text=_(<span class="string">'Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.'</span>),</span><br><span class="line">        validators=[username_validator],</span><br><span class="line">        error_messages=&#123;</span><br><span class="line">            <span class="string">'unique'</span>: _(<span class="string">"A user with that username already exists."</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">#姓</span></span><br><span class="line">    first_name = models.CharField(_(<span class="string">'first name'</span>), max_length=<span class="number">30</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment">#名</span></span><br><span class="line">    last_name = models.CharField(_(<span class="string">'last name'</span>), max_length=<span class="number">150</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    email = models.EmailField(_(<span class="string">'email address'</span>), blank=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment">#是否是员工</span></span><br><span class="line">    is_staff = models.BooleanField(</span><br><span class="line">        _(<span class="string">'staff status'</span>),</span><br><span class="line">        default=<span class="literal">False</span>,</span><br><span class="line">        help_text=_(<span class="string">'Designates whether the user can log into this admin site.'</span>),</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">#是否是可用</span></span><br><span class="line">    is_active = models.BooleanField(</span><br><span class="line">        _(<span class="string">'active'</span>),</span><br><span class="line">        default=<span class="literal">True</span>,</span><br><span class="line">        help_text=_(</span><br><span class="line">            <span class="string">'Designates whether this user should be treated as active. '</span></span><br><span class="line">            <span class="string">'Unselect this instead of deleting accounts.'</span></span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">#创建时间，什么时候加入的</span></span><br><span class="line">    date_joined = models.DateTimeField(_(<span class="string">'date joined'</span>), default=timezone.now)</span><br><span class="line"></span><br><span class="line">    objects = UserManager()</span><br><span class="line"></span><br><span class="line">    EMAIL_FIELD = <span class="string">'email'</span></span><br><span class="line">    USERNAME_FIELD = <span class="string">'username'</span></span><br><span class="line">    REQUIRED_FIELDS = [<span class="string">'email'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = _(<span class="string">'user'</span>)</span><br><span class="line">        verbose_name_plural = _(<span class="string">'users'</span>)</span><br><span class="line">        abstract = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self)</span>:</span></span><br><span class="line">        super().clean()</span><br><span class="line">        self.email = self.__class__.objects.normalize_email(self.email)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_full_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Return the first_name plus the last_name, with a space in between.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        full_name = <span class="string">'%s %s'</span> % (self.first_name, self.last_name)</span><br><span class="line">        <span class="keyword">return</span> full_name.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_short_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Return the short name for the user."""</span></span><br><span class="line">        <span class="keyword">return</span> self.first_name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">email_user</span><span class="params">(self, subject, message, from_email=None, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Send an email to this user."""</span></span><br><span class="line">        send_mail(subject, message, from_email, [self.email], **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(AbstractUser)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Users within the Django authentication system are represented by this</span></span><br><span class="line"><span class="string">    model.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Username, password and email are required. Other fields are optional.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span><span class="params">(AbstractUser.Meta)</span>:</span></span><br><span class="line">        swappable = <span class="string">'AUTH_USER_MODEL'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnonymousUser</span>:</span></span><br><span class="line">    id = <span class="literal">None</span></span><br><span class="line">    pk = <span class="literal">None</span></span><br><span class="line">    username = <span class="string">''</span></span><br><span class="line">    is_staff = <span class="literal">False</span></span><br><span class="line">    is_active = <span class="literal">False</span></span><br><span class="line">    is_superuser = <span class="literal">False</span></span><br><span class="line">    _groups = EmptyManager(Group)</span><br><span class="line">    _user_permissions = EmptyManager(Permission)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'AnonymousUser'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> isinstance(other, self.__class__)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>  <span class="comment"># instances always return the same hash value</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">"Django doesn't provide a DB representation for AnonymousUser."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">"Django doesn't provide a DB representation for AnonymousUser."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_password</span><span class="params">(self, raw_password)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">"Django doesn't provide a DB representation for AnonymousUser."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_password</span><span class="params">(self, raw_password)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">"Django doesn't provide a DB representation for AnonymousUser."</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">groups</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._groups</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">user_permissions</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._user_permissions</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_group_permissions</span><span class="params">(self, obj=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> set()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_all_permissions</span><span class="params">(self, obj=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> _user_get_all_permissions(self, obj=obj)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_perm</span><span class="params">(self, perm, obj=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> _user_has_perm(self, perm, obj=obj)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_perms</span><span class="params">(self, perm_list, obj=None)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> perm <span class="keyword">in</span> perm_list:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.has_perm(perm, obj):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_module_perms</span><span class="params">(self, module)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> _user_has_module_perms(self, module)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_anonymous</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_authenticated</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_username</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.username</span><br></pre></td></tr></table></figure>

<h2 id="User模型的基本用法"><a href="#User模型的基本用法" class="headerlink" title="User模型的基本用法"></a>User模型的基本用法</h2><h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>通过create_user方法可以快速的创建用户。这个方法必须要传递username、email、password。</p>
<p>示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line">user = User.objects.create_user(<span class="string">'zhiliao'</span>,<span class="string">'hynever@zhiliao.com'</span>,<span class="string">'111111'</span>)</span><br><span class="line"><span class="comment"># 此时user对象已经存储到数据库中了。当然你还可以继续使用user对象进行一些修改</span></span><br><span class="line">user.last_name = <span class="string">'abc'</span></span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure>

<h3 id="创建超级用户"><a href="#创建超级用户" class="headerlink" title="创建超级用户"></a>创建超级用户</h3><p>创建超级用户有两种方式。第一种是使用代码的方式。用代码创建超级用户跟创建普通用户非常的类似，只不过是使用create_superuser。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line">User.objects.create_superuser(<span class="string">'admin'</span>,<span class="string">'admin@163.com'</span>,<span class="string">'111111'</span>)</span><br></pre></td></tr></table></figure>

<p>也可以通过命令行的方式。命令如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>

<p>后面就会提示你输入用户名、邮箱以及密码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#需要输入的命令</span></span><br><span class="line">C:\Users\Administrator\Desktop\Django项目\Students_comm&gt;python manage.py createsuperuser</span><br><span class="line">Username (leave blank to use <span class="string">'administrator'</span>):      <span class="comment">#用户名</span></span><br><span class="line">Email address:                 <span class="comment">#emali 可以为空</span></span><br><span class="line">Password:                 <span class="comment">#密码：不可以纯数字，低于6位数</span></span><br><span class="line">Password (again):          <span class="comment">#确认密码</span></span><br><span class="line">Superuser created successfully.          <span class="comment">#提示超级用户创建成功</span></span><br></pre></td></tr></table></figure>

<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><p>因为密码是需要经过加密后才能存储进去的。所以如果想要修改密码，不能直接修改password字段，而需要通过调用set_password来达到修改密码的目的。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line">user = User.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">user.set_password(<span class="string">'新的密码'</span>)</span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure>

<h3 id="登录验证"><a href="#登录验证" class="headerlink" title="登录验证"></a>登录验证</h3><p>Django的验证系统已经帮我们实现了登录验证的功能。通过<strong>django.contrib.auth.authenticate</strong>即可实现。这个方法只能通过username和password来进行验证。示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> authenticate</span><br><span class="line">user = authenticate(username=<span class="string">'zhiliao'</span>, password=<span class="string">'111111'</span>)</span><br><span class="line"><span class="comment"># 如果验证通过了，那么就会返回一个user对象。</span></span><br><span class="line"><span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># 执行验证通过后的代码</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 执行验证没有通过的代码。</span></span><br></pre></td></tr></table></figure>


	</div>
	<div class="meta split">
		
			<span>本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次</span>
		
		<time class="post-date" datetime="2019-07-28T12:15:45.000Z" itemprop="datePublished">2019-07-28</time>
	</div>
</article>

<!--评论-->

	
<div class="ds-thread" data-thread-key="内置User模型的基本使用" data-title="内置User模型的基本使用" data-url="http://yoursite.com/2019/07/28/内置User模型的基本使用/"></div>
<script type="text/javascript">

var duoshuoQuery = {short_name:"yumemor"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>


  
</div>


  <svg id="bigTriangleColor" width="100%" height="40" viewBox="0 0 100 102" preserveAspectRatio="none">
    <path d="M0 0 L50 100 L100 0 Z"></path>
  </svg>

  


  <div class="wrapper"></div>





<div class="fat-footer">
	<div class="wrapper">
		<div class="layout layout--center">
			<div class="layout__item palm-mb">
				<div class="media">
					<img class="headimg" src='https://imgchr.github.la/steve.jpeg' alt='John Doe'>
					<div class="media__body">
						<h4>justpsvm</h4>
						<p class='site-description'>Stay Hungry,Stay Foolish.</p>
					</div>
				</div>
				<div class="author-contact">
					<ul>
						
							
							<li>
				        		<a href="http://weibo.com/" target="_blank">
				        			
				        				<i class="iconfont icon-weibo"></i>
				        			
				        		</a>
				        	</li>
						
							
							<li>
				        		<a href="https://github.com/" target="_blank">
				        			
				        				<i class="iconfont icon-github"></i>
				        			
				        		</a>
				        	</li>
						
							
							<li>
				        		<a href="https://www.zhihu.com/" target="_blank">
				        			
										<i class="iconfont icon-zhihu"></i>
				        			
				        		</a>
				        	</li>
						
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<footer class="footer" role="contentinfo">
	<div class="wrapper wrapper--wide split split--responsive">
		
			<span>本站总访问量 <span id="busuanzi_value_site_pv"></span> 次, 访客数 <span id="busuanzi_value_site_uv"></span> 人次</span>
		
		<span>Theme by <a href="http://github.com/justpsvm">justpsvm</a>. Powered by <a href="http://hexo.io">Hexo</a></span>
	</div>
</footer>

	<!-－这里导入了 lib.js 里面涵盖了 jQuery 等框架 所以注释掉-->
	<!--<script src="http://lib.sinaapp.com/js/jquery/2.0/jquery.min.js"></script>-->
	<script src="/js/lib.js"></script>
	<script src="/js/google-code-prettify/prettify.js"></script>
	<script src="/js/module.js"></script>
	<script src="/js/script.js"></script>
	
		<script async src="http://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
	<script type='text/javascript'>
		//代码高亮
		$(document).ready(function(){
	 		$('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
   			prettyPrint();
		});
	</script>
	</body>
</html>
